---
title: "How to Query Metadata from the Fragile Families API"
author: "Ryan Vinh and Ian E. Fellows"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to Query Metadata from the Fragile Families API}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


## Introduction

The ffmetadata package provides easy to use access to metadata surrounding the Fragile Families Project data (https://fragilefamilies.princeton.edu/). The data itself is complex, but this tool makes it easy to find and filter information about the variables included in the data. It does this by querying the Fragile Families web API. Two functions are available for use:

* `select_metadata()`: allows the user the find out specific information about a single variable
* `search_metadata()`: allows the user to search for a variable / variables based on certain parameters

```{r, echo=FALSE}
library(ffmetadata)
```

## Field names that can be used in these functions

The `select_metadata()` and `search_metadata()` functions both involve searching or using the field names of the metadata variables in some way. Below are the field names that can be used when invoking these functions:
  
* **data_source** options: collected from the questionnaire, constructed from the questionnaire, a survey weight, or the unique ID assigned to each family
* **data_type** options: ordered continuous, unordered categorical, ordered categorical, binary, or string
* **group_id**
* **group_subid**
* **id** family ID
* **label** variable description
* **leaf** survey section and question number or constructed variable name
* **name** variable name used after 2018
* **old_name** old variable name, used before 2018
* **respondent** who answered the question (e.g., "m" = "mother")
* **responses** possible responses to the question
* **scope** number of cities in which the question was asked
* **section** section of the survey
* **topic** narrow topic area
* **umbrella** broad topic area 
* **warning** reports if there is something unusual about the answer choices for this variable
* **wave** wave of the survey 

## Using `select_metadata()` to find out information out about a variable

Suppose we want to find out the value of a given variable's field.  For example, let's say we want to find out the source of the variable with the name "ce3datey". To accomplish this, we would call `select_metadata()` using "ce3datey" for `variable_name` and "data_source" for `fields`.

```{r}
select_type <- select_metadata(variable_name = "ce3datey", fields = "data_source")
print(select_type)
```

`select_metadata()` can also be used to find out information about several fields of a given variable along the following lines:

```{r}
select <- select_metadata(variable_name = "ce3datey", fields = c("data_source", "data_type"))
```


If we want to view the entire variable and all the values for its fields, we can call select_metadata without using the `fields` parameter and simply using "ce3datey" for `variable_name`. This will return ce3datey as a data frame row, with each of its fields corresponding to a column of that row.

```{r}
select_full <- select_metadata(variable_name = "ce3datey")
```

`select_metadata()` also has an optional `returnDataFrame` parameter that is set to `TRUE` by default.  This means that `select_metadata()` will return a data frame by default for when no fields are specified or multiple fields are specified. However, if `returnDataFrame` is set to `FALSE`, a nested list object will be returned instead. 

## Using `search_metadata()` to search for variables

`search_metadata()` allows users to search for variables based on specified field values. This function returns a list of all the variable names that match the specified parameters.  For instance, suppose we want to search for all the variables from wave 3. To accomplish this, we would call `search_metadata()` in the following way:

```{r, results = "asis"}
search <- search_metadata(wave = 3)
```

Any of the above-specified fields can be used to search for variables in combination with one another.  For example, suppose we want to search for all the variables from wave 3 that also have the value "oc" for data_type.  To accomplish this, we would call `search_metadata()` like so:

```{r}
search <- search_metadata(wave = 3, data_type = "oc")
```


TODO: `search_metadata()` also provides functionality for wild card matching.
